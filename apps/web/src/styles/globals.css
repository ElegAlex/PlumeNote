@import "tailwindcss";
@plugin "@tailwindcss/typography";

/* ===================================
   Tailwind v4 Theme Configuration
   =================================== */
@theme {
  /* Font families */
  --font-sans: "Inter", system-ui, sans-serif;
  --font-mono: "JetBrains Mono", monospace;

  /* Border radius */
  --radius-lg: var(--radius);
  --radius-md: calc(var(--radius) - 2px);
  --radius-sm: calc(var(--radius) - 4px);

  /* Colors - mapped to CSS variables for dynamic theming */
  --color-border: hsl(var(--border));
  --color-input: hsl(var(--input));
  --color-ring: hsl(var(--ring));
  --color-background: hsl(var(--background));
  --color-foreground: hsl(var(--foreground));

  --color-primary: hsl(var(--primary));
  --color-primary-foreground: hsl(var(--primary-foreground));

  --color-secondary: hsl(var(--secondary));
  --color-secondary-foreground: hsl(var(--secondary-foreground));

  --color-destructive: hsl(var(--destructive));
  --color-destructive-foreground: hsl(var(--destructive-foreground));

  --color-muted: hsl(var(--muted));
  --color-muted-foreground: hsl(var(--muted-foreground));

  --color-accent: hsl(var(--accent));
  --color-accent-foreground: hsl(var(--accent-foreground));

  --color-popover: hsl(var(--popover));
  --color-popover-foreground: hsl(var(--popover-foreground));

  --color-card: hsl(var(--card));
  --color-card-foreground: hsl(var(--card-foreground));
}

/* ===================================
   CSS Custom Properties for theming
   =================================== */
:root {
  --background: 0 0% 100%;
  --foreground: 222.2 84% 4.9%;

  --card: 0 0% 100%;
  --card-foreground: 222.2 84% 4.9%;

  --popover: 0 0% 100%;
  --popover-foreground: 222.2 84% 4.9%;

  --primary: 221.2 83.2% 53.3%;
  --primary-foreground: 210 40% 98%;

  --secondary: 210 40% 96.1%;
  --secondary-foreground: 222.2 47.4% 11.2%;

  --muted: 210 40% 96.1%;
  --muted-foreground: 215.4 16.3% 46.9%;

  --accent: 210 40% 96.1%;
  --accent-foreground: 222.2 47.4% 11.2%;

  --destructive: 0 84.2% 60.2%;
  --destructive-foreground: 210 40% 98%;

  --border: 214.3 31.8% 91.4%;
  --input: 214.3 31.8% 91.4%;
  --ring: 221.2 83.2% 53.3%;

  --radius: 0.5rem;
}

.dark {
  --background: 222.2 84% 4.9%;
  --foreground: 210 40% 98%;

  --card: 222.2 84% 4.9%;
  --card-foreground: 210 40% 98%;

  --popover: 222.2 84% 4.9%;
  --popover-foreground: 210 40% 98%;

  --primary: 217.2 91.2% 59.8%;
  --primary-foreground: 222.2 47.4% 11.2%;

  --secondary: 217.2 32.6% 17.5%;
  --secondary-foreground: 210 40% 98%;

  --muted: 217.2 32.6% 17.5%;
  --muted-foreground: 215 20.2% 65.1%;

  --accent: 217.2 32.6% 17.5%;
  --accent-foreground: 210 40% 98%;

  --destructive: 0 62.8% 30.6%;
  --destructive-foreground: 210 40% 98%;

  --border: 217.2 32.6% 17.5%;
  --input: 217.2 32.6% 17.5%;
  --ring: 224.3 76.3% 48%;
}

/* ===================================
   Base styles
   =================================== */
* {
  @apply border-border;
}

body {
  @apply bg-background text-foreground;
  font-feature-settings: "rlig" 1, "calt" 1;
}

/* Scrollbar styling */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  @apply bg-transparent;
}

::-webkit-scrollbar-thumb {
  @apply bg-border rounded-full;
}

::-webkit-scrollbar-thumb:hover {
  @apply bg-muted-foreground/30;
}

/* ===================================
   TipTap Editor styles
   =================================== */
.tiptap {
  @apply prose prose-sm max-w-none focus:outline-none;
}

.tiptap p.is-editor-empty:first-child::before {
  @apply text-muted-foreground pointer-events-none float-left h-0;
  content: attr(data-placeholder);
}

.tiptap .collaboration-cursor__caret {
  @apply border-l-2 border-r-0 ml-[-1px] mr-[-1px];
  pointer-events: none;
  position: relative;
  word-break: normal;
}

.tiptap .collaboration-cursor__label {
  @apply rounded-sm rounded-bl-none px-1 py-0.5 text-xs text-white whitespace-nowrap;
  font-size: 0.75rem;
  font-style: normal;
  font-weight: 600;
  left: -1px;
  line-height: normal;
  position: absolute;
  top: -1.4em;
  user-select: none;
}

/* Wikilink styles */
.wikilink {
  @apply text-primary underline decoration-primary/30 hover:decoration-primary cursor-pointer;
}

.wikilink.broken {
  @apply text-destructive italic decoration-destructive/30;
}

/* Code block styles */
.tiptap pre {
  @apply bg-muted rounded-lg p-4 font-mono text-sm;
}

.tiptap code {
  @apply bg-muted px-1 py-0.5 rounded text-sm font-mono;
}

.tiptap pre code {
  @apply bg-transparent p-0;
}

/* Task list styles */
.tiptap ul[data-type="taskList"] {
  @apply list-none pl-0;
}

.tiptap ul[data-type="taskList"] li {
  @apply flex gap-2 items-start;
}

.tiptap ul[data-type="taskList"] li > label {
  @apply shrink-0 mt-0.5;
}

.tiptap ul[data-type="taskList"] li > div {
  @apply flex-1;
}

/* Callout styles (US-015) */
.tiptap .callout {
  @apply my-4;
}

.tiptap .callout .callout-content {
  @apply text-sm;
}

.tiptap .callout .callout-content > *:first-child {
  @apply mt-0;
}

.tiptap .callout .callout-content > *:last-child {
  @apply mb-0;
}

/* Callout nested content styling */
.tiptap .callout ul,
.tiptap .callout ol {
  @apply my-2;
}

.tiptap .callout pre {
  @apply my-2;
}

.tiptap .callout blockquote {
  @apply my-2 border-l-2 pl-4 italic;
  border-color: currentColor;
  opacity: 0.8;
}

/* Tag styles (US-017) */
.tiptap .inline-tag {
  @apply text-primary font-medium cursor-pointer px-1 py-0.5 rounded;
  @apply bg-primary/10 hover:bg-primary/20 transition-colors;
}

/* Tag suggestion popup */
.tag-suggestion-popup {
  animation: fadeIn 0.15s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Math styles (US-018) */
.tiptap .math-inline {
  @apply inline-block px-1 py-0.5 rounded bg-muted/50;
}

.tiptap .math-block {
  @apply my-4 py-4 px-6 bg-muted/30 rounded-lg;
}

.tiptap .math-render {
  @apply transition-all;
}

.tiptap .math-render:hover {
  @apply bg-muted/50;
}

.tiptap .math-editor textarea {
  @apply resize-none;
}

/* Mermaid styles (US-019) */
.tiptap .mermaid-block {
  @apply my-4;
}

.tiptap .mermaid-render {
  @apply transition-all;
}

.tiptap .mermaid-render:hover {
  @apply shadow-md;
}

.tiptap .mermaid-svg svg {
  @apply max-w-full h-auto;
}

.tiptap .mermaid-editor textarea {
  @apply resize-y;
}

/* Toggle styles (US-020) */
.tiptap .toggle-block {
  @apply my-3;
}

.tiptap .toggle-section {
  @apply transition-all;
}

.tiptap .toggle-inner > *:first-child {
  @apply mt-0;
}

.tiptap .toggle-inner > *:last-child {
  @apply mb-0;
}

/* ===================================
   DARK MODE - Editor specific styles
   =================================== */

/* Editor base colors */
.dark .tiptap {
  @apply text-foreground;
}

/* Editor placeholder */
.dark .tiptap p.is-editor-empty:first-child::before {
  @apply text-muted-foreground;
}

/* Editor code blocks */
.dark .tiptap pre {
  @apply bg-[hsl(217.2,32.6%,12%)];
}

.dark .tiptap code {
  @apply bg-muted;
}

/* Editor blockquotes */
.dark .tiptap blockquote {
  @apply border-border text-muted-foreground;
}

/* Editor tables */
.dark .tiptap table th {
  @apply bg-muted;
}

.dark .tiptap table td,
.dark .tiptap table th {
  @apply border-border;
}

/* Editor selection */
.dark .tiptap ::selection {
  @apply bg-primary/30;
}

/* Wikilink dark mode */
.dark .wikilink {
  @apply text-primary decoration-primary/40;
}

.dark .wikilink.broken {
  @apply text-destructive decoration-destructive/40;
}

/* Task list dark mode - checkbox */
.dark .tiptap ul[data-type="taskList"] li > label input[type="checkbox"] {
  @apply border-border bg-background;
}

.dark .tiptap ul[data-type="taskList"] li > label input[type="checkbox"]:checked {
  @apply bg-primary border-primary;
}

/* Callout dark mode */
.dark .tiptap .callout {
  @apply border-border;
}

/* Math dark mode */
.dark .tiptap .math-inline,
.dark .tiptap .math-block {
  @apply bg-muted/30;
}

/* Mermaid dark mode - text adjustments */
.dark .tiptap .mermaid-svg {
  filter: invert(0.9) hue-rotate(180deg);
}

/* ===================================
   DARK MODE - Sidebar styles
   =================================== */

/* Sidebar container */
.dark .sidebar,
.dark [data-sidebar] {
  @apply bg-[hsl(222.2,84%,3%)] border-border;
}

/* Sidebar items */
.dark .sidebar-item,
.dark [data-sidebar-item] {
  @apply hover:bg-muted/50;
}

.dark .sidebar-item.active,
.dark [data-sidebar-item].active {
  @apply bg-primary/10 text-primary;
}

/* Sidebar section headers */
.dark .sidebar-section-header {
  @apply text-muted-foreground;
}

/* Sidebar folder icons */
.dark .folder-icon {
  @apply text-muted-foreground;
}

/* Sidebar note items */
.dark .note-item {
  @apply text-foreground/80;
}

.dark .note-item:hover {
  @apply text-foreground bg-muted/30;
}

/* ===================================
   DARK MODE - Dialog/Modal styles
   =================================== */

.dark [role="dialog"],
.dark [data-radix-dialog-content] {
  @apply bg-card border-border;
}

/* ===================================
   DARK MODE - Form elements
   =================================== */

.dark input,
.dark textarea,
.dark select {
  @apply bg-background border-input text-foreground;
}

.dark input::placeholder,
.dark textarea::placeholder {
  @apply text-muted-foreground;
}

.dark input:focus,
.dark textarea:focus,
.dark select:focus {
  @apply ring-ring border-ring;
}

/* ===================================
   DARK MODE - Dropdown menus
   =================================== */

.dark [data-radix-menu-content],
.dark [role="menu"] {
  @apply bg-popover border-border;
}

.dark [data-radix-menu-item],
.dark [role="menuitem"] {
  @apply text-popover-foreground;
}

.dark [data-radix-menu-item]:hover,
.dark [role="menuitem"]:hover {
  @apply bg-accent text-accent-foreground;
}

/* ===================================
   DARK MODE - Tooltips
   =================================== */

.dark [role="tooltip"],
.dark [data-radix-tooltip-content] {
  @apply bg-popover text-popover-foreground border-border;
}

/* ===================================
   DARK MODE - Prose (rendered markdown)
   =================================== */

.dark .prose {
  @apply text-foreground;
}

.dark .prose h1,
.dark .prose h2,
.dark .prose h3,
.dark .prose h4,
.dark .prose h5,
.dark .prose h6 {
  @apply text-foreground;
}

.dark .prose a {
  @apply text-primary;
}

.dark .prose strong {
  @apply text-foreground;
}

.dark .prose code {
  @apply bg-muted text-foreground;
}

.dark .prose pre {
  @apply bg-[hsl(217.2,32.6%,12%)];
}

.dark .prose blockquote {
  @apply border-border text-muted-foreground;
}

.dark .prose hr {
  @apply border-border;
}

.dark .prose thead {
  @apply border-border;
}

.dark .prose tbody tr {
  @apply border-border;
}

/* ===================================
   Code Block Syntax Highlighting
   Compatible with lowlight/highlight.js
   =================================== */

/* Code block container */
.code-block-highlight {
  @apply relative my-4 rounded-lg overflow-hidden;
}

.code-block-highlight pre {
  @apply bg-[#1e1e2e] text-[#cdd6f4] p-4 overflow-x-auto;
  @apply font-mono text-sm leading-relaxed;
  margin: 0;
}

.code-block-highlight code {
  @apply bg-transparent p-0 font-mono;
  color: inherit;
}

/* Light mode code blocks */
:root .code-block-highlight pre {
  @apply bg-[#f6f8fa] text-[#24292f];
}

/* Highlight.js / Lowlight token styles - Dark Theme (Catppuccin) */
.dark .code-block-highlight .hljs-keyword,
.dark .code-block-highlight .hljs-selector-tag,
.dark .code-block-highlight .hljs-built_in,
.dark .code-block-highlight .hljs-name {
  @apply text-[#cba6f7]; /* mauve */
}

.dark .code-block-highlight .hljs-string,
.dark .code-block-highlight .hljs-attr,
.dark .code-block-highlight .hljs-symbol,
.dark .code-block-highlight .hljs-bullet,
.dark .code-block-highlight .hljs-addition {
  @apply text-[#a6e3a1]; /* green */
}

.dark .code-block-highlight .hljs-title,
.dark .code-block-highlight .hljs-section,
.dark .code-block-highlight .hljs-selector-id {
  @apply text-[#89b4fa]; /* blue */
}

.dark .code-block-highlight .hljs-class .hljs-title,
.dark .code-block-highlight .hljs-type {
  @apply text-[#f9e2af]; /* yellow */
}

.dark .code-block-highlight .hljs-function,
.dark .code-block-highlight .hljs-title.function_ {
  @apply text-[#89b4fa]; /* blue */
}

.dark .code-block-highlight .hljs-variable,
.dark .code-block-highlight .hljs-template-variable {
  @apply text-[#f38ba8]; /* red */
}

.dark .code-block-highlight .hljs-comment,
.dark .code-block-highlight .hljs-quote,
.dark .code-block-highlight .hljs-meta {
  @apply text-[#6c7086] italic; /* overlay0 */
}

.dark .code-block-highlight .hljs-number,
.dark .code-block-highlight .hljs-literal {
  @apply text-[#fab387]; /* peach */
}

.dark .code-block-highlight .hljs-regexp,
.dark .code-block-highlight .hljs-link {
  @apply text-[#94e2d5]; /* teal */
}

.dark .code-block-highlight .hljs-deletion {
  @apply text-[#f38ba8] bg-[#f38ba8]/10; /* red */
}

.dark .code-block-highlight .hljs-emphasis {
  @apply italic;
}

.dark .code-block-highlight .hljs-strong {
  @apply font-bold;
}

/* Light mode token styles (GitHub-inspired) */
.code-block-highlight .hljs-keyword,
.code-block-highlight .hljs-selector-tag,
.code-block-highlight .hljs-built_in,
.code-block-highlight .hljs-name {
  @apply text-[#cf222e];
}

.code-block-highlight .hljs-string,
.code-block-highlight .hljs-attr,
.code-block-highlight .hljs-symbol,
.code-block-highlight .hljs-bullet,
.code-block-highlight .hljs-addition {
  @apply text-[#0a3069];
}

.code-block-highlight .hljs-title,
.code-block-highlight .hljs-section,
.code-block-highlight .hljs-selector-id {
  @apply text-[#8250df];
}

.code-block-highlight .hljs-class .hljs-title,
.code-block-highlight .hljs-type {
  @apply text-[#953800];
}

.code-block-highlight .hljs-function,
.code-block-highlight .hljs-title.function_ {
  @apply text-[#8250df];
}

.code-block-highlight .hljs-variable,
.code-block-highlight .hljs-template-variable {
  @apply text-[#953800];
}

.code-block-highlight .hljs-comment,
.code-block-highlight .hljs-quote,
.code-block-highlight .hljs-meta {
  @apply text-[#6e7781] italic;
}

.code-block-highlight .hljs-number,
.code-block-highlight .hljs-literal {
  @apply text-[#0550ae];
}

.code-block-highlight .hljs-regexp,
.code-block-highlight .hljs-link {
  @apply text-[#116329];
}

.code-block-highlight .hljs-deletion {
  @apply text-[#82071e] bg-[#ffebe9];
}

.code-block-highlight .hljs-emphasis {
  @apply italic;
}

.code-block-highlight .hljs-strong {
  @apply font-bold;
}

/* Language label */
.code-block-highlight::before {
  @apply absolute top-2 right-2 text-xs text-muted-foreground/60 font-mono uppercase;
  content: attr(data-language);
}

/* Line numbers (optional - add .with-line-numbers class) */
.code-block-highlight.with-line-numbers code {
  counter-reset: line;
}

.code-block-highlight.with-line-numbers code > * {
  counter-increment: line;
}

.code-block-highlight.with-line-numbers code > *::before {
  @apply inline-block w-8 mr-4 text-right text-muted-foreground/40 select-none;
  content: counter(line);
}

/* ===================================
   Root Folder Coloration
   Couleurs pastels automatiques
   =================================== */

.root-folder {
  background-color: var(--folder-bg);
  margin-bottom: 2px;
}

.root-folder:hover {
  background-color: var(--folder-bg-hover) !important;
}

.root-folder.bg-blue-100,
.dark .root-folder.dark\:bg-blue-900\/30 {
  /* Quand sélectionné, garder la couleur de sélection */
  background-color: inherit;
}

/* ===================================
   FEAT-07: Search & Replace Highlighting
   =================================== */

.search-result {
  background-color: rgba(255, 200, 0, 0.4);
  border-radius: 2px;
}

.search-result-current {
  background-color: rgba(255, 150, 0, 0.6);
  box-shadow: 0 0 0 2px rgba(255, 150, 0, 0.4);
}

/* Dark mode adjustments */
.dark .search-result {
  background-color: rgba(255, 200, 0, 0.3);
}

.dark .search-result-current {
  background-color: rgba(255, 150, 0, 0.5);
  box-shadow: 0 0 0 2px rgba(255, 150, 0, 0.3);
}
